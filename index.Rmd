---
title: "R User Groups | Meetup.com"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: scroll
    self_contained: false
    includes:
      after_body: "afterInit.html"
    css: css/custom.css
---

```{r setup, include=FALSE}
library(flexdashboard)
library(stringr)
library(dplyr)
library(lubridate)
library(echarts4r)
library(DT)
devtools::load_all()
```

```{r read_data, include=FALSE}
rugs_full <- read_rugs()
rugs_cumul <- read_cumulative()
rugs_stats <- read_summary()[[1]]
rugs_locations <- read_summary()[[2]] %>% 
  tidyr::pivot_longer(everything(), names_to = "location")

mycolor <- c("#2780e3","#003636","#a9a9a9", "#91c8c8")
```

```{r process, include=FALSE, cache=TRUE}
location_translation <- c(
  us_can = "US/Canada",
  eur = "Europe",
  latinAm = "Latin America",
  asia = "Asia",
  aus = "Australia",
  afr = "Africa"
)

by_year <- rugs_cumul %>% 
  mutate(year = floor_date(datecreated, "year")) %>% 
  count(year)

years <- by_year %>% 
  pull(year) %>% 
  length()
```


Sidebar {.sidebar data-width=200}
=====================================

<div class="sidebar-pages">
<a class="navlink" href="#home" data-toggle="tab" aria-expanded="false"><i class="fa fa-home"></i> Home</a>
</div>


Home
=====================================

Row
-------------------------------------

### R User Groups

```{r}
valueBox(rugs_stats %>% pull(chapters), icon = "fa-users", color = "#435f9c")
```

### Members

```{r}
valueBox(rugs_stats %>% pull(members), icon = "fa-user", color = "#0586c4")
```

### Countries

```{r}
valueBox(rugs_stats %>% pull(countries), icon = "fa-globe", color = "#435f9c")
```

### Cities

```{r}
valueBox(rugs_stats %>% pull(city), icon = "fa-map-marker", color = "#0586c4")
```

Row
-----------------------------------------------------------------------

### Past Events

```{r}
valueBox(rugs_stats %>% pull(past_events), icon = "fa-calendar-minus-o", color = "#435f9c")
```

### Upcoming Events

```{r}
valueBox(rugs_stats %>% pull(upcoming_events), icon = "fa-calendar-plus-o", color = "#0586c4")
```

### Years

```{r}
valueBox(years, icon = "fa-calendar", color = "#435f9c")
```

Row
-----------------------------------------------------------------------

### R User Groups Across Regions

```{r}
rugs_locations %>%
  filter(!str_detect(location, "_m")) %>% 
  arrange(desc(value)) %>% 
  mutate(location = recode(location, !!!location_translation)) %>%
  e_charts(location) %>%
  e_bar(value, legend = FALSE, name = "Number of Groups") %>%
  e_y_axis(
    splitArea = list(show = TRUE),
    axisPointer = list(
      show = FALSE,
      lineStyle = list(
        color = "#9978ad",
        width = 0.75,
        type = "dotted"
      )
    )
  ) %>%
  e_x_axis(
    splitArea = list(show = TRUE),
    splitLine = list(show = TRUE),
    axisLabel = list(interval = 0)
  ) %>%
  e_toolbox_feature(feature = "magicType",
                    type = list("area", "line", "bar")) %>%
  e_toolbox_feature("restore") %>%
  e_toolbox_feature(feature = "reset") %>%
  e_toolbox_feature("dataView") %>%
  e_toolbox_feature("saveAsImage") %>%
  e_animation(duration = 1000) %>%
  e_tooltip(trigger = "axis") %>% 
  e_color(color = "#80bbd6") 
```

### R Users Across Regions

```{r}
rugs_locations %>%
  filter(str_detect(location, "_m")) %>%
  arrange(desc(value)) %>%
  mutate(
    location = str_remove(location, "_m"),
    location = recode(location,!!!location_translation)
  ) %>%
  e_charts(location) %>%
  e_pie(value, radius = c("20%", "70%"), name = "Number of R Users") %>%
  e_tooltip() %>%
  e_color(c(
    "#4ca0c6",
    "#34495E",
    "#BDC3C7",
    "#c6d6dd",
    "#a9a9a9",
    "#3498DB",
    "#025376"
  ))
```


Row
-----------------------------------------------------------------------

### Top Groups by Events

```{r}
rugs_full %>%
  select(name, past_events) %>%
  slice_max(past_events, n = 20, with_ties = FALSE) %>% 
  arrange(desc(past_events)) %>%
  datatable(
    .,
    class = 'cell-border stripe',
    colnames = c("Name of User Group", "Events"),
    rownames = FALSE,
    options = list(
      lengthMenu = c(5, 10, 20),
      pageLength = 10,
      scrollY = 300,
      dom = 'ltp'
    )
  )
```

### Top Groups by Members

```{r}
rugs_full %>%
  select(name, members) %>%
  slice_max(members, n = 20, with_ties = FALSE) %>% 
  arrange(desc(members)) %>%
  datatable(
    .,
    class = 'cell-border stripe',
    colnames = c("Name of User Group", "Members"),
    rownames = FALSE,
    options = list(
      lengthMenu = c(5, 10, 20),
      pageLength = 10,
      scrollY = 300,
      dom = 'ltp'
    )
  )
```

Row
-----------------------------------------------------------------------

### Locate an R User Group

```{r}
rugs_full %>% 
  arrange(desc(created)) %>% 
  datatable(
    .,
    class = 'cell-border stripe',
    caption = "Ordered by the Newest Groups",
    extensions = "Buttons",
    rownames = FALSE,
    escape = FALSE,
    filter = 'top',
    options = list(
      scrollY = 600,
      lengthMenu = c(5, 10, 25, 50, 100),
      pageLength = 10,
      dom = '<"flex-control"lBf>tip',
      buttons = list('copy', list(
        extend = 'collection',
        buttons = c('csv', 'excel'),
        text = 'Download'
      ))
    )
  )
```

